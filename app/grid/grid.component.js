"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var letter_component_1 = require("./letter.component");
var router_1 = require("nativescript-angular/router");
var GridComponent = /** @class */ (function () {
    function GridComponent(router) {
        this.router = router;
        this.rows = 10;
        this.cols = 10;
        this.alphabet = "abcdefghijklmnopqrstuvwxyz";
        this.words = ["OBJECTIVEC", "VARIABLE", "KOTLIN", "MOBILE", "SWIFT", "JAVA"];
        this.wordFound = "Word found!";
        this.wordInvalid = "Not quite! Try again.";
        this.allWordsFound = "Congratulations! You found all the words!";
        this.selectedLetters = [];
        this.foundWords = [];
        this.grid = [[]];
        this.validationMessage = "";
    }
    GridComponent.prototype.ngOnInit = function () {
        this.selectedLetters = [];
        this.buildGrid();
    };
    GridComponent.prototype.letterClick = function (col) {
        this.validationMessage = "";
        if (typeof col != undefined) {
            col.clickNum++;
            if (col.clickNum % 2 != 0) { //odd numbers mean it has been selected
                this.selectedLetters.push(col);
                col.indexInSelection = this.selectedLetters.length - 1;
            }
            else if (col.clickNum > 0) { //it has been unselected
                //find it in selectedLetters, confirm that it is the same letter, and remove it
                var indexToRemove = col.indexInSelection;
                if (this.selectedLetters[indexToRemove].value === col.value) {
                    this.selectedLetters.splice(indexToRemove, 1);
                    //decrement index of all proceeding selected letters
                    for (var i = indexToRemove; i < this.selectedLetters.length; i++) {
                        this.selectedLetters[i].indexInSelection--;
                    }
                }
            }
        }
    };
    GridComponent.prototype.validateSelection = function () {
        var selectedWord = "";
        var isValid = true;
        for (var _i = 0, _a = this.selectedLetters; _i < _a.length; _i++) {
            var letter = _a[_i];
            selectedWord = selectedWord.concat(letter.value);
            //check that letters appear all in straight row, column, or diagonal
            //row and col differences should always either be 1 or 0
            var i = this.selectedLetters.indexOf(letter);
            if (i > 0) {
                var colDiff = this.selectedLetters[i].col - this.selectedLetters[i - 1].col;
                var rowDiff = this.selectedLetters[i].row - this.selectedLetters[i - 1].row;
                if (colDiff > 1 || colDiff < 0 || rowDiff > 1 || rowDiff < 0) {
                    this.validationMessage = this.wordInvalid;
                    isValid = false;
                }
            }
        }
        if (!isValid) {
            for (var _b = 0, _c = this.selectedLetters; _b < _c.length; _b++) {
                var letter = _c[_b];
                this.grid[letter.row][letter.col].clickNum = 0;
            }
        }
        this.selectedLetters = [];
        if (isValid) {
            if (typeof this.words.indexOf(selectedWord) !== undefined && this.words.indexOf(selectedWord) > -1) {
                this.foundWords.push(this.words.splice(this.words.indexOf(selectedWord), 1));
                this.validationMessage = this.wordFound;
                if (this.words.length === 0) {
                    this.validationMessage = this.allWordsFound;
                }
                return true;
            }
        }
        return false;
    };
    GridComponent.prototype.buildGrid = function () {
        var newGrid = [[]];
        newGrid.length = 0;
        for (var i = 0; i < this.rows; i++) {
            var currentRow = [];
            for (var j = 0; j < this.cols; j++) {
                var rand = this.getRandomInt(26);
                var letter = this.alphabet[rand].toString().toUpperCase();
                var currentSpace = new letter_component_1.LetterComponent(false, letter);
                currentSpace.row = i;
                currentSpace.col = j;
                currentRow.push(currentSpace);
            }
            newGrid.push(currentRow);
        }
        this.grid = newGrid;
        this.placeWords();
    };
    GridComponent.prototype.placeWords = function () {
        for (var _i = 0, _a = this.words; _i < _a.length; _i++) {
            var word = _a[_i];
            var wordAsComponents = [];
            for (var _b = 0, word_1 = word; _b < word_1.length; _b++) {
                var letter = word_1[_b];
                wordAsComponents.push(new letter_component_1.LetterComponent(true, letter));
            }
            //randomly determine orientation
            var orientation_1 = this.getRandomInt(3);
            var placedWord = this.getIndexes(wordAsComponents, orientation_1);
            for (var _c = 0, placedWord_1 = placedWord; _c < placedWord_1.length; _c++) {
                var letter = placedWord_1[_c];
                this.grid[letter.row][letter.col] = letter;
            }
        }
    };
    GridComponent.prototype.getIndexes = function (word, orientation) {
        var rowIndex = 0;
        var colIndex = 0;
        switch (orientation) {
            case 0: { //horizontal
                //need to limit colIndex to make sure word fits
                colIndex = this.getRandomIndex(word);
                //rowIndex can be any index on vertical axis of grid
                rowIndex = this.getRandomInt(this.rows);
                var i = 0;
                while (i < word.length) {
                    var currIndex = this.grid[rowIndex][colIndex];
                    if (typeof currIndex !== 'undefined' && currIndex.value !== word[i].value && currIndex.isInWord) {
                        //restart word, one row down
                        rowIndex = this.getRandomInt(this.rows);
                        colIndex = this.getRandomIndex(word);
                        i = 0;
                        continue;
                    }
                    else {
                        word[i].row = rowIndex;
                        word[i].col = colIndex;
                        colIndex++;
                        i++;
                    }
                }
                break;
            }
            case 1: { //vertical
                //need to limit rowIndex to make sure word fits
                rowIndex = this.getRandomIndex(word);
                //rowIndex can be any index on vertical axis of grid
                colIndex = this.getRandomInt(this.rows);
                var i = 0;
                while (i < word.length) {
                    var currIndex = this.grid[rowIndex][colIndex];
                    if (typeof currIndex !== 'undefined' && currIndex.value !== word[i].value && currIndex.isInWord) {
                        //restart word, one col over
                        colIndex = this.getRandomInt(this.cols);
                        rowIndex = this.getRandomIndex(word);
                        i = 0;
                        continue;
                    }
                    else {
                        word[i].row = rowIndex;
                        word[i].col = colIndex;
                        rowIndex++;
                        i++;
                    }
                }
                break;
            }
            case 2: { //diagonal
                rowIndex = this.getRandomIndex(word);
                colIndex = this.getRandomIndex(word);
                var i = 0;
                while (i < word.length) {
                    var currIndex = this.grid[rowIndex][colIndex];
                    if (typeof currIndex !== 'undefined' && currIndex.value !== word[i].value && currIndex.isInWord) {
                        //restart word, one col over and one row down
                        colIndex = this.getRandomIndex(word);
                        rowIndex = this.getRandomIndex(word);
                        i = 0;
                        continue;
                    }
                    else {
                        word[i].row = rowIndex;
                        word[i].col = colIndex;
                        rowIndex++;
                        colIndex++;
                        i++;
                    }
                }
                break;
            }
            default: {
                break;
            }
        }
        return word;
    };
    GridComponent.prototype.getRandomIndex = function (word) {
        //assume this.rows = this.cols
        var possibleSpaces = this.rows - word.length;
        var index = this.getRandomInt(possibleSpaces + 1);
        return index;
    };
    GridComponent.prototype.getRandomInt = function (max) {
        return Math.floor(Math.random() * Math.floor(max));
    };
    GridComponent.prototype.returnHome = function () {
        this.router.back();
    };
    GridComponent = __decorate([
        core_1.Component({
            selector: "Grid",
            moduleId: module.id,
            templateUrl: "./grid.component.html",
            styleUrls: ["./grid.component.css"]
        }),
        __metadata("design:paramtypes", [router_1.RouterExtensions])
    ], GridComponent);
    return GridComponent;
}());
exports.GridComponent = GridComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JpZC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJncmlkLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHNDQUFrRDtBQUNsRCx1REFBcUQ7QUFHckQsc0RBQStEO0FBUS9EO0lBYUksdUJBQW9CLE1BQXdCO1FBQXhCLFdBQU0sR0FBTixNQUFNLENBQWtCO1FBWnBDLFNBQUksR0FBVyxFQUFFLENBQUM7UUFDbEIsU0FBSSxHQUFXLEVBQUUsQ0FBQztRQUNsQixhQUFRLEdBQVcsNEJBQTRCLENBQUM7UUFDaEQsVUFBSyxHQUFHLENBQUMsWUFBWSxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxNQUFNLENBQUMsQ0FBQztRQUN4RSxjQUFTLEdBQUcsYUFBYSxDQUFDO1FBQzFCLGdCQUFXLEdBQUcsdUJBQXVCLENBQUM7UUFDdEMsa0JBQWEsR0FBRywyQ0FBMkMsQ0FBQztRQUM1RCxvQkFBZSxHQUFzQixFQUFFLENBQUM7UUFDeEMsZUFBVSxHQUFHLEVBQUUsQ0FBQztRQUNoQixTQUFJLEdBQXdCLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDakMsc0JBQWlCLEdBQUcsRUFBRSxDQUFDO0lBRWlCLENBQUM7SUFFakQsZ0NBQVEsR0FBUjtRQUNJLElBQUksQ0FBQyxlQUFlLEdBQUcsRUFBRSxDQUFDO1FBQzFCLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQTtJQUNwQixDQUFDO0lBRUQsbUNBQVcsR0FBWCxVQUFZLEdBQW9CO1FBQzVCLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxFQUFFLENBQUM7UUFFNUIsSUFBSSxPQUFPLEdBQUcsSUFBSSxTQUFTLEVBQUU7WUFDekIsR0FBRyxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBRWYsSUFBSSxHQUFHLENBQUMsUUFBUSxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSx1Q0FBdUM7Z0JBQ2hFLElBQUksQ0FBQyxlQUFlLENBQUMsSUFB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LGtDQUFVLEdBQVY7UUFDSSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ3ZCLENBQUM7SUF0T1EsYUFBYTtRQU56QixnQkFBUyxDQUFDO1lBQ1AsUUFBUSxFQUFFLE1BQU07WUFDaEIsUUFBUSxFQUFFLE1BQU0sQ0FBQyxFQUFFO1lBQ25CLFdBQVcsRUFBRSx1QkFBdUI7WUFDcEMsU0FBUyxFQUFFLENBQUMsc0JBQXNCLENBQUM7U0FDdEMsQ0FBQzt5Q0FjOEIseUJBQWdCO09BYm5DLGFBQWEsQ0F1T3pCO0lBQUQsb0JBQUM7Q0FBQSxBQXZPRCxJQXVPQztBQXZPWSxzQ0FBYSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0IH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7IExldHRlckNvbXBvbmVudCB9IGZyb20gXCIuL2xldHRlci5jb21wb25lbnRcIjtcbmltcG9ydCB7IFBhZ2UsIEV2ZW50RGF0YSB9IGZyb20gXCJ0bnMtY29yZS1tb2R1bGVzL3VpL3BhZ2UvcGFnZVwiO1xuaW1wb3J0IHsgQWN0aXZhdGVkUm91dGUsIFJvdXRlciB9IGZyb20gXCJAYW5ndWxhci9yb3V0ZXJcIjtcbmltcG9ydCB7IFJvdXRlckV4dGVuc2lvbnMgfSBmcm9tIFwibmF0aXZlc2NyaXB0LWFuZ3VsYXIvcm91dGVyXCI7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiBcIkdyaWRcIixcbiAgICBtb2R1bGVJZDogbW9kdWxlLmlkLFxuICAgIHRlbXBsYXRlVXJsOiBcIi4vZ3JpZC5jb21wb25lbnQuaHRtbFwiLFxuICAgIHN0eWxlVXJsczogW1wiLi9ncmlkLmNvbXBvbmVudC5jc3NcIl1cbn0pXG5leHBvcnQgY2xhc3MgR3JpZENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gICAgcHJpdmF0ZSByb3dzOiBudW1iZXIgPSAxMDtcbiAgICBwcml2YXRlIGNvbHM6IG51bWJlciA9IDEwO1xuICAgIHByaXZhdGUgYWxwaGFiZXQ6IHN0cmluZyA9IFwiYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXpcIjtcbiAgICBwcml2YXRlIHdvcmRzID0gW1wiT0JKRUNUSVZFQ1wiLCBcIlZBUklBQkxFXCIsIFwiS09UTElOXCIsIFwiTU9CSUxFXCIsIFwiU1dJRlRcIiwgXCJKQVZBXCJdO1xuICAgIHByaXZhdGUgd29yZEZvdW5kID0gXCJXb3JkIGZvdW5kIVwiO1xuICAgIHByaXZhdGUgd29yZEludmFsaWQgPSBcIk5vdCBxdWl0ZSEgVHJ5IGFnYWluLlwiO1xuICAgIHByaXZhdGUgYWxsV29yZHNGb3VuZCA9IFwiQ29uZ3JhdHVsYXRpb25zISBZb3UgZm91bmQgYWxsIHRoZSB3b3JkcyFcIjtcbiAgICBwcml2YXRlIHNlbGVjdGVkTGV0dGVyczogTGV0dGVyQ29tcG9uZW50W10gPSBbXTtcbiAgICBwcml2YXRlIGZvdW5kV29yZHMgPSBbXTtcbiAgICBwcml2YXRlIGdyaWQ6IExldHRlckNvbXBvbmVudFtdW10gPSBbW11dO1xuICAgIHByaXZhdGUgdmFsaWRhdGlvbk1lc3NhZ2UgPSBcIlwiO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSByb3V0ZXI6IFJvdXRlckV4dGVuc2lvbnMpIHsgfVxuXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRMZXR0ZXJzID0gW107XG4gICAgICAgIHRoaXMuYnVpbGRHcmlkKClcbiAgICB9XG5cbiAgICBsZXR0ZXJDbGljayhjb2w6IExldHRlckNvbXBvbmVudCkge1xuICAgICAgICB0aGlzLnZhbGlkYXRpb25NZXNzYWdlID0gXCJcIjtcblxuICAgICAgICBpZiAodHlwZW9mIGNvbCAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNvbC5jbGlja051bSsrO1xuXG4gICAgICAgICAgICBpZiAoY29sLmNsaWNrTnVtICUgMiAhPSAwKSB7IC8vb2RkIG51bWJlcnMgbWVhbiBpdCBoYXMgYmVlbiBzZWxlY3RlZFxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRMZXR0ZXJzLnB1c2goY29sKTtcbiAgICAgICAgICAgICAgICBjb2wuaW5kZXhJblNlbGVjdGlvbiA9IHRoaXMuc2VsZWN0ZWRMZXR0ZXJzLmxlbmd0aCAtIDE7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGNvbC5jbGlja051bSA+IDApIHsgLy9pdCBoYXMgYmVlbiB1bnNlbGVjdGVkXG4gICAgICAgICAgICAgICAgLy9maW5kIGl0IGluIHNlbGVjdGVkTGV0dGVycywgY29uZmlybSB0aGF0IGl0IGlzIHRoZSBzYW1lIGxldHRlciwgYW5kIHJlbW92ZSBpdFxuICAgICAgICAgICAgICAgIGxldCBpbmRleFRvUmVtb3ZlID0gY29sLmluZGV4SW5TZWxlY3Rpb247XG5cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zZWxlY3RlZExldHRlcnNbaW5kZXhUb1JlbW92ZV0udmFsdWUgPT09IGNvbC52YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkTGV0dGVycy5zcGxpY2UoaW5kZXhUb1JlbW92ZSwgMSk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy9kZWNyZW1lbnQgaW5kZXggb2YgYWxsIHByb2NlZWRpbmcgc2VsZWN0ZWQgbGV0dGVyc1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gaW5kZXhUb1JlbW92ZTsgaSA8IHRoaXMuc2VsZWN0ZWRMZXR0ZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkTGV0dGVyc1tpXS5pbmRleEluU2VsZWN0aW9uLS07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB2YWxpZGF0ZVNlbGVjdGlvbigpOiBib29sZWFuIHtcbiAgICAgICAgbGV0IHNlbGVjdGVkV29yZCA9IFwiXCJcbiAgICAgICAgbGV0IGlzVmFsaWQgPSB0cnVlO1xuXG4gICAgICAgIGZvciAobGV0IGxldHRlciBvZiB0aGlzLnNlbGVjdGVkTGV0dGVycykge1xuICAgICAgICAgICAgc2VsZWN0ZWRXb3JkID0gc2VsZWN0ZWRXb3JkLmNvbmNhdChsZXR0ZXIudmFsdWUpO1xuXG4gICAgICAgICAgICAvL2NoZWNrIHRoYXQgbGV0dGVycyBhcHBlYXIgYWxsIGluIHN0cmFpZ2h0IHJvdywgY29sdW1uLCBvciBkaWFnb25hbFxuICAgICAgICAgICAgLy9yb3cgYW5kIGNvbCBkaWZmZXJlbmNlcyBzaG91bGQgYWx3YXlzIGVpdGhlciBiZSAxIG9yIDBcbiAgICAgICAgICAgIGxldCBpID0gdGhpcy5zZWxlY3RlZExldHRlcnMuaW5kZXhPZihsZXR0ZXIpO1xuICAgICAgICAgICAgaWYgKGkgPiAwKSB7XG4gICAgICAgICAgICAgICAgbGV0IGNvbERpZmYgPSB0aGlzLnNlbGVjdGVkTGV0dGVyc1tpXS5jb2wgLSB0aGlzLnNlbGVjdGVkTGV0dGVyc1tpIC0gMV0uY29sO1xuICAgICAgICAgICAgICAgIGxldCByb3dEaWZmID0gdGhpcy5zZWxlY3RlZExldHRlcnNbaV0ucm93IC0gdGhpcy5zZWxlY3RlZExldHRlcnNbaSAtIDFdLnJvdztcbiAgICAgICAgICAgICAgICBpZiAoY29sRGlmZiA+IDEgfHwgY29sRGlmZiA8IDAgfHwgcm93RGlmZiA+IDEgfHwgcm93RGlmZiA8IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52YWxpZGF0aW9uTWVzc2FnZSA9IHRoaXMud29yZEludmFsaWQ7XG4gICAgICAgICAgICAgICAgICAgIGlzVmFsaWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZighaXNWYWxpZCkge1xuICAgICAgICAgICAgZm9yIChsZXQgbGV0dGVyIG9mIHRoaXMuc2VsZWN0ZWRMZXR0ZXJzKXtcbiAgICAgICAgICAgICAgICB0aGlzLmdyaWRbbGV0dGVyLnJvd11bbGV0dGVyLmNvbF0uY2xpY2tOdW0gPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zZWxlY3RlZExldHRlcnMgPSBbXTtcblxuICAgICAgICBpZiAoaXNWYWxpZCkge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB0aGlzLndvcmRzLmluZGV4T2Yoc2VsZWN0ZWRXb3JkKSAhPT0gdW5kZWZpbmVkICYmIHRoaXMud29yZHMuaW5kZXhPZihzZWxlY3RlZFdvcmQpID4gLTEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZvdW5kV29yZHMucHVzaCh0aGlzLndvcmRzLnNwbGljZSh0aGlzLndvcmRzLmluZGV4T2Yoc2VsZWN0ZWRXb3JkKSwgMSkpO1xuICAgICAgICAgICAgICAgIHRoaXMudmFsaWRhdGlvbk1lc3NhZ2UgPSB0aGlzLndvcmRGb3VuZDtcblxuICAgICAgICAgICAgICAgIGlmICh0aGlzLndvcmRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnZhbGlkYXRpb25NZXNzYWdlID0gdGhpcy5hbGxXb3Jkc0ZvdW5kO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGJ1aWxkR3JpZCgpIHtcbiAgICAgICAgbGV0IG5ld0dyaWQgPSBbW11dO1xuICAgICAgICBuZXdHcmlkLmxlbmd0aCA9IDA7XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnJvd3M7IGkrKykge1xuICAgICAgICAgICAgbGV0IGN1cnJlbnRSb3cgPSBbXTtcblxuICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLmNvbHM7IGorKykge1xuICAgICAgICAgICAgICAgIGxldCByYW5kID0gdGhpcy5nZXRSYW5kb21JbnQoMjYpO1xuICAgICAgICAgICAgICAgIGxldCBsZXR0ZXIgPSB0aGlzLmFscGhhYmV0W3JhbmRdLnRvU3RyaW5nKCkudG9VcHBlckNhc2UoKTtcbiAgICAgICAgICAgICAgICBsZXQgY3VycmVudFNwYWNlID0gbmV3IExldHRlckNvbXBvbmVudChmYWxzZSwgbGV0dGVyKTtcbiAgICAgICAgICAgICAgICBjdXJyZW50U3BhY2Uucm93ID0gaTtcbiAgICAgICAgICAgICAgICBjdXJyZW50U3BhY2UuY29sID0gajtcbiAgICAgICAgICAgICAgICBjdXJyZW50Um93LnB1c2goY3VycmVudFNwYWNlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbmV3R3JpZC5wdXNoKGN1cnJlbnRSb3cpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5ncmlkID0gbmV3R3JpZDtcbiAgICAgICAgdGhpcy5wbGFjZVdvcmRzKCk7XG4gICAgfVxuXG4gICAgcGxhY2VXb3JkcygpOiB2b2lkIHtcbiAgICAgICAgXG4gICAgICAgIGZvciAobGV0IHdvcmQgb2YgdGhpcy53b3Jkcykge1xuICAgICAgICAgICAgbGV0IHdvcmRBc0NvbXBvbmVudHMgPSBbXVxuICAgICAgICAgICAgZm9yIChsZXQgbGV0dGVyIG9mIHdvcmQpIHtcbiAgICAgICAgICAgICAgICB3b3JkQXNDb21wb25lbnRzLnB1c2gobmV3IExldHRlckNvbXBvbmVudCh0cnVlLCBsZXR0ZXIpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy9yYW5kb21seSBkZXRlcm1pbmUgb3JpZW50YXRpb25cbiAgICAgICAgICAgIGxldCBvcmllbnRhdGlvbiA9IHRoaXMuZ2V0UmFuZG9tSW50KDMpO1xuICAgICAgICAgICAgbGV0IHBsYWNlZFdvcmQgPSB0aGlzLmdldEluZGV4ZXMod29yZEFzQ29tcG9uZW50cywgb3JpZW50YXRpb24pO1xuXG4gICAgICAgICAgICBmb3IgKGxldCBsZXR0ZXIgb2YgcGxhY2VkV29yZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JpZFtsZXR0ZXIucm93XVtsZXR0ZXIuY29sXSA9IGxldHRlcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldEluZGV4ZXMod29yZDogTGV0dGVyQ29tcG9uZW50W10sIG9yaWVudGF0aW9uOiBudW1iZXIpOiBMZXR0ZXJDb21wb25lbnRbXSB7XG4gICAgICAgIGxldCByb3dJbmRleDogbnVtYmVyID0gMDtcbiAgICAgICAgbGV0IGNvbEluZGV4OiBudW1iZXIgPSAwO1xuXG4gICAgICAgIHN3aXRjaCAob3JpZW50YXRpb24pIHtcbiAgICAgICAgICAgIGNhc2UgMDogeyAvL2hvcml6b250YWxcbiAgICAgICAgICAgICAgICAvL25lZWQgdG8gbGltaXQgY29sSW5kZXggdG8gbWFrZSBzdXJlIHdvcmQgZml0c1xuICAgICAgICAgICAgICAgIGNvbEluZGV4ID0gdGhpcy5nZXRSYW5kb21JbmRleCh3b3JkKTtcbiAgICAgICAgICAgICAgICAvL3Jvd0luZGV4IGNhbiBiZSBhbnkgaW5kZXggb24gdmVydGljYWwgYXhpcyBvZiBncmlkXG4gICAgICAgICAgICAgICAgcm93SW5kZXggPSB0aGlzLmdldFJhbmRvbUludCh0aGlzLnJvd3MpO1xuXG4gICAgICAgICAgICAgICAgbGV0IGkgPSAwO1xuICAgICAgICAgICAgICAgIHdoaWxlIChpIDwgd29yZC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGN1cnJJbmRleCA9IHRoaXMuZ3JpZFtyb3dJbmRleF1bY29sSW5kZXhdO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgY3VyckluZGV4ICE9PSAndW5kZWZpbmVkJyAmJiBjdXJySW5kZXgudmFsdWUgIT09IHdvcmRbaV0udmFsdWUgJiYgY3VyckluZGV4LmlzSW5Xb3JkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL3Jlc3RhcnQgd29yZCwgb25lIHJvdyBkb3duXG4gICAgICAgICAgICAgICAgICAgICAgICByb3dJbmRleCA9IHRoaXMuZ2V0UmFuZG9tSW50KHRoaXMucm93cyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xJbmRleCA9IHRoaXMuZ2V0UmFuZG9tSW5kZXgod29yZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgd29yZFtpXS5yb3cgPSByb3dJbmRleDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmRbaV0uY29sID0gY29sSW5kZXg7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xJbmRleCsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgaSsrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjYXNlIDE6IHsgLy92ZXJ0aWNhbFxuICAgICAgICAgICAgICAgIC8vbmVlZCB0byBsaW1pdCByb3dJbmRleCB0byBtYWtlIHN1cmUgd29yZCBmaXRzXG4gICAgICAgICAgICAgICAgcm93SW5kZXggPSB0aGlzLmdldFJhbmRvbUluZGV4KHdvcmQpO1xuICAgICAgICAgICAgICAgIC8vcm93SW5kZXggY2FuIGJlIGFueSBpbmRleCBvbiB2ZXJ0aWNhbCBheGlzIG9mIGdyaWRcbiAgICAgICAgICAgICAgICBjb2xJbmRleCA9IHRoaXMuZ2V0UmFuZG9tSW50KHRoaXMucm93cyk7XG5cbiAgICAgICAgICAgICAgICBsZXQgaSA9IDA7XG4gICAgICAgICAgICAgICAgd2hpbGUgKGkgPCB3b3JkLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBsZXQgY3VyckluZGV4ID0gdGhpcy5ncmlkW3Jvd0luZGV4XVtjb2xJbmRleF07XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGN1cnJJbmRleCAhPT0gJ3VuZGVmaW5lZCcgJiYgY3VyckluZGV4LnZhbHVlICE9PSB3b3JkW2ldLnZhbHVlICYmIGN1cnJJbmRleC5pc0luV29yZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy9yZXN0YXJ0IHdvcmQsIG9uZSBjb2wgb3ZlclxuICAgICAgICAgICAgICAgICAgICAgICAgY29sSW5kZXggPSB0aGlzLmdldFJhbmRvbUludCh0aGlzLmNvbHMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcm93SW5kZXggPSB0aGlzLmdldFJhbmRvbUluZGV4KHdvcmQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaSA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmRbaV0ucm93ID0gcm93SW5kZXg7XG4gICAgICAgICAgICAgICAgICAgICAgICB3b3JkW2ldLmNvbCA9IGNvbEluZGV4O1xuICAgICAgICAgICAgICAgICAgICAgICAgcm93SW5kZXgrKztcbiAgICAgICAgICAgICAgICAgICAgICAgIGkrKztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY2FzZSAyOiB7IC8vZGlhZ29uYWxcbiAgICAgICAgICAgICAgICByb3dJbmRleCA9IHRoaXMuZ2V0UmFuZG9tSW5kZXgod29yZCk7XG4gICAgICAgICAgICAgICAgY29sSW5kZXggPSB0aGlzLmdldFJhbmRvbUluZGV4KHdvcmQpO1xuXG4gICAgICAgICAgICAgICAgbGV0IGkgPSAwO1xuICAgICAgICAgICAgICAgIHdoaWxlIChpIDwgd29yZC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGN1cnJJbmRleCA9IHRoaXMuZ3JpZFtyb3dJbmRleF1bY29sSW5kZXhdO1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjdXJySW5kZXggIT09ICd1bmRlZmluZWQnICYmIGN1cnJJbmRleC52YWx1ZSAhPT0gd29yZFtpXS52YWx1ZSAmJiBjdXJySW5kZXguaXNJbldvcmQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vcmVzdGFydCB3b3JkLCBvbmUgY29sIG92ZXIgYW5kIG9uZSByb3cgZG93blxuICAgICAgICAgICAgICAgICAgICAgICAgY29sSW5kZXggPSB0aGlzLmdldFJhbmRvbUluZGV4KHdvcmQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcm93SW5kZXggPSB0aGlzLmdldFJhbmRvbUluZGV4KHdvcmQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaSA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmRbaV0ucm93ID0gcm93SW5kZXg7XG4gICAgICAgICAgICAgICAgICAgICAgICB3b3JkW2ldLmNvbCA9IGNvbEluZGV4O1xuICAgICAgICAgICAgICAgICAgICAgICAgcm93SW5kZXgrKztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbEluZGV4Kys7XG4gICAgICAgICAgICAgICAgICAgICAgICBpKys7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gd29yZDtcbiAgICB9XG5cbiAgICBnZXRSYW5kb21JbmRleCh3b3JkOiBMZXR0ZXJDb21wb25lbnRbXSk6IG51bWJlciB7XG4gICAgICAgIC8vYXNzdW1lIHRoaXMucm93cyA9IHRoaXMuY29sc1xuICAgICAgICBsZXQgcG9zc2libGVTcGFjZXMgPSB0aGlzLnJvd3MgLSB3b3JkLmxlbmd0aFxuICAgICAgICBsZXQgaW5kZXggPSB0aGlzLmdldFJhbmRvbUludChwb3NzaWJsZVNwYWNlcyArIDEpO1xuICAgICAgICByZXR1cm4gaW5kZXg7XG4gICAgfVxuXG4gICAgZ2V0UmFuZG9tSW50KG1heDogbnVtYmVyKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIE1hdGguZmxvb3IobWF4KSk7XG4gICAgfVxuXG4gICAgcmV0dXJuSG9tZSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5yb3V0ZXIuYmFjaygpO1xuICAgIH1cbn1cbiJdfQ==